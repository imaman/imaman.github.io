<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>  
    <script src="matrix.min.js"></script>
    <script src="canvas-mouse.js"></script>

    <style>
        .wrapper {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
        }    

        #snapshot_1 {
            overflow: auto;

            max-width: 1320px;
            max-height: 400px
        }

    </style>
</head>
<body>
    <div id="snapshot_container_1">
        <div id="snapshot_1" style="position: relative; left: 30px;">
            <!-- <image src="download.png" width="1280" height="4096">  -->
        </div>
        <div style="font-family: 'Courier New', Courier, monospace;"><span>Current: </span><span id="status_bar_1"></span></div>
    </div>

    <script>
    function reportError(e) {
        alert('Operation failed ' + e.stack);
    }

    $(document).ready(() => {
        startEditor();
    });

    function startEditor(savedSanpshot, imageUrl) {
        drawTagger('snapshot_1', 'status_bar_1', "download.png"); 
    }


    function drawTagger(parentId, statusBarId, imageUrl) {
        const parent = document.getElementById(parentId);
        if (!parent) {
            throw new Error(`No element with ID ${parnentId} was found`);
        }

        const img = new Image();
        img.addEventListener('load', () => {

            const factor = 1.0;
            const canvasElementString = `<canvas width="${img.width * factor}" height="${img.height * factor}";"></canvas>`;
            console.log('Creating new canvas...');
            const canvas = $(canvasElementString).addClass('first').addClass('base-element');
            $(canvas).appendTo(parent);
            const ctx = canvas[0].getContext('2d');

            ctx.scale(factor, factor);
            ctx.drawImage(img, 0, 0);        
            ctx.stroke();


            const canvas2 = $(canvasElementString).addClass('second').addClass('fills-base-element');
            const ctx2 = canvas2[0].getContext('2d');
            ctx2.globalCompositeOperation = "copy"

            // const matrix = new Matrix(ctx);
            // // Create an instance of our position handler
            // const cm = new CanvasMouse(ctx2, {
            //     handleScroll: true,
            //     handleResize: true,
            //     handleScale: true,
            //     handleTransforms: true,
            //     matrix
            // });


            // // cm.init();

            // canvas2[0].onmousemove = e => {
            //     e.preventDefault();
            //     e.stopPropagation();
            //     const pos = cm.getPos(e);
            //     // const layoutTreeNode = findLayoutTreeNode(savedSnapshot, pos);
            //     // higligher.draw(layoutTreeNode);
            // };


            // canvas2.mouseleave(() => {
            //     higligher.draw(null);
            // });

            $(canvas2).appendTo(parent);
        });
        img.src = imageUrl;
    }

    </script>
</body>
</html>
